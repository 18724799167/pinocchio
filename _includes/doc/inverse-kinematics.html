<head>
<title>Stack of Tasks lab: inverse kinematics</title>

<link rel="stylesheet" href="style.css" />
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}



a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}

</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Stack of Tasks lab: inverse kinematics</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_objective">Objective</h2>
<div class="sectionbody">
<div class="paragraph"><p>In this first series of exercises, we are going to take in hand the library Pinocchio in order to build a model
of a robot, display this robot in a graphical user interface and control the robot to achieve geometric tasks.
We will first try to achieve a positioning task for one hand, then we will enforce the static balance of the robot.
Finally, we will implement a hierarchy of task in order to achieve both task : to reach a desired position for the hand
ensuring we are in a statically balanced position.</p></div>
<div class="paragraph"><p>The software Pinocchio is a C++ library provided with a python wrapping that allows us to control it with a python terminal.
Let&#8217;s see how it works.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_0_tips">Tutorial 0. Tips</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_python">Python</h3>
<div class="paragraph"><p>We remind you that you can open a python terminal in your own shell. Simply type :
bash terminal</p></div>
<div class="literalblock">
<div class="content">
<pre><code>student@student-virtualbox:~$ python
&gt;&gt;&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Afterwards you&#8217;ll just have to type your commands in this newly opened terminal.</p></div>
<div class="paragraph"><p>To close the python terminal, just type CTRL-D (CTRL-C first to interrupt any on-going execution).</p></div>
<div class="paragraph"><p>You can also write you command lines in a file and launch this script without entering the interactive mode
(ie. without starting a new python terminal). In your shell, just type:
bash terminal</p></div>
<div class="literalblock">
<div class="content">
<pre><code>student@student-virtualbox:~$ python script.py
&gt;&gt;&gt;</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_pinocchio">Pinocchio</h3>
<div class="paragraph"><p><strong>Basic mathematical objects:</strong></p></div>
<div class="paragraph"><p>In the following, we will use numpy Matrix class to represent matrices and vectors.
In numpy, vectors simply are matrices with one column. See the following example.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> numpy as np
A <span style="color: #990000">=</span> np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">matrix</span></span><span style="color: #990000">([</span> <span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">3</span><span style="color: #990000">,</span><span style="color: #993399">4</span><span style="color: #990000">],[</span><span style="color: #993399">5</span><span style="color: #990000">,</span><span style="color: #993399">6</span><span style="color: #990000">,</span><span style="color: #993399">7</span><span style="color: #990000">,</span><span style="color: #993399">8</span><span style="color: #990000">]])</span> <span style="font-style: italic"><span style="color: #9A1900"># Define a 2x4 matrix</span></span>
b <span style="color: #990000">=</span> np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">zeros</span></span><span style="color: #990000">([</span><span style="color: #993399">4</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">])</span>   <span style="font-style: italic"><span style="color: #9A1900"># Define a 4 vector (ie a 4x1 matrix) initialized with 0.</span></span>
c <span style="color: #990000">=</span> A<span style="color: #990000">*</span>b               <span style="font-style: italic"><span style="color: #9A1900"># Obtain c by multiplying A by b.</span></span></tt></pre></div></div>
<div class="paragraph"><p>A bunch of useful functions are packaged in the utils of pinocchio.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> pinocchio<span style="color: #990000">.</span>utils <span style="font-weight: bold"><span style="color: #000080">import</span></span> <span style="color: #990000">*</span>
<span style="font-weight: bold"><span style="color: #000000">eye</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">)</span>                    <span style="font-style: italic"><span style="color: #9A1900"># Return a 6x6 identity matrix</span></span>
<span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">)</span>                   <span style="font-style: italic"><span style="color: #9A1900"># Return a zero 6x1 vector</span></span>
<span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">([</span><span style="color: #993399">6</span><span style="color: #990000">,</span><span style="color: #993399">4</span><span style="color: #990000">])</span>               <span style="font-style: italic"><span style="color: #9A1900"># Return az zero 6x4 matrix</span></span>
<span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">)</span>                   <span style="font-style: italic"><span style="color: #9A1900"># Random 6x1 vector</span></span>
<span style="font-weight: bold"><span style="color: #000000">isapprox</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">),</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">))</span> <span style="font-style: italic"><span style="color: #9A1900"># Test epsilon equality</span></span>
<span style="font-weight: bold"><span style="color: #000000">mprint</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">([</span><span style="color: #993399">6</span><span style="color: #990000">,</span><span style="color: #993399">6</span><span style="color: #990000">]))</span>       <span style="font-style: italic"><span style="color: #9A1900"># Matlab-style print</span></span>
<span style="font-weight: bold"><span style="color: #000000">skew</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">))</span>             <span style="font-style: italic"><span style="color: #9A1900"># Skew "cross-product" 3x3 matrix from a 3x1 vector</span></span>
<span style="font-weight: bold"><span style="color: #000000">cross</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">),</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">))</span>    <span style="font-style: italic"><span style="color: #9A1900"># Cross product of R^3</span></span>
<span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'x'</span><span style="color: #990000">,</span><span style="color: #993399">0.4</span><span style="color: #990000">)</span>           <span style="font-style: italic"><span style="color: #9A1900"># Build a rotation matrix of 0.4rad around X.</span></span></tt></pre></div></div>
<div class="paragraph"><p>Specific classes are defined to represent objects of SE(3), se(3) and se(3)^*. Rigid displacements, elements of SE(3), are represented by the class SE3.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> pinocchio as se3
R <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">eye</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">);</span> p <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">)</span>
M0 <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SE3</span></span><span style="color: #990000">(</span>R<span style="color: #990000">,</span>p<span style="color: #990000">)</span>
M <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">()</span>
M<span style="color: #990000">.</span>translation <span style="color: #990000">=</span> p<span style="color: #990000">;</span> M<span style="color: #990000">.</span>rotation <span style="color: #990000">=</span> R</tt></pre></div></div>
<div class="paragraph"><p>Spatial velocities, elements of se(3) = M^6, are represented by the class Motion.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>v <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">);</span> w <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">)</span>
nu0 <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Motion</span></span><span style="color: #990000">(</span>v<span style="color: #990000">,</span>w<span style="color: #990000">)</span>
nu <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>Motion<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">()</span>
nu<span style="color: #990000">.</span>linear <span style="color: #990000">=</span> v<span style="color: #990000">;</span> nu<span style="color: #990000">.</span>angular <span style="color: #990000">=</span> w</tt></pre></div></div>
<div class="paragraph"><p>Spatial forces, elements of se(3)<sup>* = F</sup>6, are represented by the class Force.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>f <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">);</span> tau <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">)</span>
phi0 <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Force</span></span><span style="color: #990000">(</span>f<span style="color: #990000">,</span>tau<span style="color: #990000">)</span>
phi <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>Force<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">()</span>
phi<span style="color: #990000">.</span>linear <span style="color: #990000">=</span> f<span style="color: #990000">;</span> phi<span style="color: #990000">.</span>angular <span style="color: #990000">=</span> tau</tt></pre></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_1_creating_and_displaying_the_robot">Tutorial 1. Creating and displaying the robot</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_robot_kinematic_tree">Robot kinematic tree</h3>
<div class="paragraph"><p>The kinematic tree is represented by two C++ objects called Model (which
contains the model constants: lengths, masses, names, etc) and Data (which
contains the working memory used by the model algorithms). Both C\++ objects are
contained in a unique Python class. Two classes are currently available.
The first one is called RobotWrapper and is generic. This is the one you should use
with your own urdf model.
The second one is called RomeoWrapper and is correlated to the romeo_small.urdf provided with
the package. It implements some shortcuts specifics to our model and specify a half-sitting
configuration.</p></div>
<div class="paragraph"><p>For the next steps, we are going to work with the RomeoWrapper.</p></div>
<div class="paragraph"><p>Import the class <code>RomeoWrapper</code> and create an instance of this class in the
python terminal. At initialization, RomeoWrapper will read the model
description in the URDF file given as argument. In the following, we will use
the model of the Romeo robot, available in the directory "models" of Pinocchio.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> pinocchio<span style="color: #990000">.</span>romeo_wrapper <span style="font-weight: bold"><span style="color: #000080">import</span></span> RomeoWrapper

robot <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">RomeoWrapper</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'path/to/urdf/romeo_small.urdf'</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The code of the RomeoWrapper class is in /path/to/pinocchio//src/python/romeo_wrapper.py . Do not hesitate to have a look at it and to take inspiration from the implementation of the class functions.</p></div>
</div>
<div class="sect2">
<h3 id="_exploring_the_model">Exploring the model</h3>
<div class="paragraph"><p>The robot model is available in robot.model. It contains the names of all the
robot joint [names], the kinematic tree [parents] (i.e. the graph of parents, 0
being the root and having no parents), the position of the current joint in the
parent coordinate frame [jointPosition], the mass, inertia and
center-of-gravity position of all the bodies (condensed in a spatial inertia
6x6 matrix) [inertias] and the gravity of the associated world [gravity]. All
these functions are documented and are available in the correponding class
dictionnary.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">for</span></span> name<span style="color: #990000">,</span>function <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> robot<span style="color: #990000">.</span>model<span style="color: #990000">.</span>__class__<span style="color: #990000">.</span>__dict__<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">items</span></span><span style="color: #990000">():</span>
  <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">" **** "</span><span style="color: #990000">,</span> name<span style="color: #990000">,</span> <span style="color: #FF0000">": "</span><span style="color: #990000">,</span> function<span style="color: #990000">.</span>__doc__</tt></pre></div></div>
<div class="paragraph"><p>Similarly, the robot data are available in robot.data. All the variables
allocated by the classical rigid-body dynamics algorithms are stored in
robot.data and are available through the python wrapping. Similarly to the
model object, the function are documented and are available from the class
dictionnary. The most useful in the following will be the placement of the
frame associated which each joint output stored in robot.data.oMi.</p></div>
<div class="paragraph"><p>For example, the right hand of Romeo corresponds to the output of the right
wrist joint, called RWristPitch. The ID of the joint in the joint list can be
recovered from its name, and then used to access its placement:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">index</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span>name<span style="color: #990000">):</span>
   <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">[</span> idx <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> idx<span style="color: #990000">,</span>name <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">enumerate</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span>model<span style="color: #990000">.</span>names<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> name<span style="color: #990000">==</span><span style="color: #FF0000">"RWristPitch"</span> <span style="color: #990000">][</span><span style="color: #993399">0</span><span style="color: #990000">]</span>

<span style="font-style: italic"><span style="color: #9A1900"># Get the placement of joint number idx</span></span>
placement <span style="color: #990000">=</span> robot<span style="color: #990000">.</span>data<span style="color: #990000">.</span>oMi<span style="color: #990000">[</span>idx<span style="color: #990000">]</span></tt></pre></div></div>
<div class="paragraph"><p>Shortcuts are implemented for the right wrist (rh), left
wrist (lh), right ankle (rf) and left ankle (lf). You can get the placement
corresponding to the right hand with robot.Mrh(q) and the corresponding
Jacobian (6D, expressed in the body frame) with robot.Jrh.</p></div>
<div class="paragraph"><p>Finally, some recurring datas (used in Model and Data) have been wrapped to functions in some
python shortcuts, also available in RomeoWrapper:
+The size of the robot configuration is given by nq.
+The dimension of its tangent space (velocity) is nv.
+The index of a joint in the tree can be accessed from its name by index (see above).
+The classical algorithms are also binded: com, Jcom, mass, biais, joint gravity, position and velocity of each joint.
+Shortcuts are also implemented for the placement and the Jacobian (6D, expressed in the body frame) of
the right wrist(rh), left wrist(lh), right ankle(rf), left ankle (lf).For example, you can access the right wrist
placement and Jacobian with robot.Mrh(q) and robot.Jrh(q)</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span>nq<span style="color: #990000">)</span>
v <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span>nv<span style="color: #990000">)</span>
robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">com</span></span><span style="color: #990000">(</span>q<span style="color: #990000">)</span>            <span style="font-style: italic"><span style="color: #9A1900"># Compute the robot center of mass.</span></span>
robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">position</span></span><span style="color: #990000">(</span>q<span style="color: #990000">,</span><span style="color: #993399">23</span><span style="color: #990000">)</span>    <span style="font-style: italic"><span style="color: #9A1900"># Compute the placement of joint 23</span></span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_display_the_robot">Display the robot</h3>
<div class="paragraph"><p>To display the robot, we need an external program called <code>Gepetto Viewer</code>.
If you completed the installation in the previous page, you can launch this
program, open a new terminal in an empty workspace.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>student@student-virtualbox:~$ gepetto-viewer-server</code></pre>
</div></div>
<div class="paragraph"><p>This will start a server waiting for instructions. We will now create a client that will ask
the server to perform some requests (such as creating a window or displaying our robot)
In a python terminal you can test the following :</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> gepetto<span style="color: #990000">.</span>corbaserver <span style="font-weight: bold"><span style="color: #000080">import</span></span> Client
client <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Client</span></span> <span style="color: #990000">()</span>
<span style="font-style: italic"><span style="color: #9A1900"># open a new window</span></span>
client<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createWindow</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"w"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This should have opened a window referenced as "w" in the gepetto-server. But this window is empty.
In order to display the robot, we need to load its visual geometry. This can be performed with:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> gepetto<span style="color: #990000">.</span>corbaserver <span style="font-weight: bold"><span style="color: #000080">import</span></span> Client
client<span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #000000">Client</span></span><span style="color: #990000">()</span>
client<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createWindow</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"w"</span><span style="color: #990000">)</span>
client<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createSceneWithFloor</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"world"</span><span style="color: #990000">)</span>
client<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addSceneToWindow</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"world"</span><span style="color: #990000">,</span><span style="color: #FF0000">"w"</span><span style="color: #990000">)</span>
client<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addURDF</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"world/romeo"</span><span style="color: #990000">,</span><span style="color: #FF0000">"/path/to/urdf//romeo_small.urdf"</span><span style="color: #990000">,</span><span style="color: #FF0000">"/path/to/meshes/dir/"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Be careful : Using the <code>addURDF</code> method, you load the robot in memory and parse the urdf file.
The representation in the viewver is such that it need to have a root node that need to be added to the world.
That&#8217;s why we set the root node as world/romeo in the above example. Moreover the kinematic chain in gepetto
viewer is slightly different from the one in pinocchio. In the viewer, the bodies are stored as nodes
whereas in Pinocchio we store the joints. You can get the list of the node links in gepetto viewer typing
in your python terminal :</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>client<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getNodeList</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>This list will be printed in the terminal running the gepetto viewer.</p></div>
<div class="paragraph"><p>You will also note that all the bodies are displayed at the same location. In fact, the viewer only loads
the meshes associated to the links of our robot. If you want to move these bodies, you can use
 <code>applyConfiguration("node",config)</code>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>q1 <span style="color: #990000">=</span> <span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">]</span>
client<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">applyConfiguration</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'world/romeo/HeadRollLink'</span><span style="color: #990000">,</span>q1<span style="color: #990000">)</span>
client<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">refresh</span></span><span style="color: #990000">()</span> <span style="font-style: italic"><span style="color: #9A1900"># Refresh the window.</span></span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_publishing_the_robot_configuration">Publishing the robot configuration</h3>
<div class="paragraph"><p><strong>Objectives:</strong> Touch the difference between Pinocchio and Gepetto-viewer kinematic trees.
Play with SE3, display rigid bodies in the world, compute and update the robot position.</p></div>
<div class="paragraph"><p>Previously, we have seen how to load the robot model in Pinocchio and in the gepetto-viewer.
And how to update the placement of a body in the viewer. Now we will see the correspondance
between the model in Pinocchio and the one in the viewer.</p></div>
<div class="paragraph"><p>The body origin is attached to the parent joint location (plus an offset). So to display the
body attached to a joint (e.g the left arm attached to the left shoulder), we only need the coordinates
of the joint.
Hence, to display the Head in the viewer, we compute the position of the joint parent of the head link.
This joint is <em>HeadRoll</em></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>head_joint_id <span style="color: #990000">=</span> robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">index</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'HeadRoll'</span><span style="color: #990000">)</span>
M <span style="color: #990000">=</span> robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">position</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span>q0<span style="color: #990000">,</span>head_joint_id<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The placement of every joint is computed using <code>robot.position</code>. This function returns an object M
of class se3.SE3. The two main fields are M.translation (3x1 vector) and M.rotation (3x3 orthogonal matrix)
. The corresponding homogeneous matrix is given by M.homogeneous. This matrix must be converted into a
configuration vector of dimension 7 (x,y,z + a quaternion). You can perform it  with:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">se3ToConfig</span></span><span style="color: #990000">(</span>M<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p><strong>Question:</strong>  For each body in the gepetto-viewer, retrieve the associated joint then its placement
and display the robot Romeo in the viewer.</p></div>
<div class="paragraph"><p>As all of the joints do not have a body representation (for exemple, HeadPitch), and that it is pretty heavy
to compute and update the placement of each body by hand, a function has been implemented in the romeowrapper.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">display</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span>q0<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This function compute the placement of each joints that have a body attached to them and
update the body corresponding in the viewer (communicating the new position, orientation and refreshing the
window). To do so, we bind the Pinocchio robot to the one in the gepetto viewer by initializint the
connexion. The argument needed is the root node of the romeo tree in gepetto-viewer.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">initDisplay</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"world/romeo/"</span><span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_moving_the_robot_joints">Moving the robot joints</h3>
<div class="paragraph"><p><strong>Objective:</strong> Touch the difference between a simple integration in R^n and the
 exponential map in SE3.</p></div>
<div class="paragraph"><p>The robot configuration q and velocity qdot do not have the same dimension.</p></div>
<div class="paragraph"><p><strong>Why?</strong></p></div>
<div class="paragraph"><p>The placement of the robot hip in the world is given by 3 translation q[0,0],
q[1,0], q[2,0] and a quaternion q[3:7], total 7 parameters. On the opposite,
the hip velocity is given by the spatial velocity (element of the Lie Algebra
se(3)) representing the relative movement of the world and the hip frames,
written using the coordinate system of the world frame. This corresponds to 3
linear velocities qdot[0:3] and 3 angular ones qdot[3:6]. Total, 6 parameters.</p></div>
<div class="paragraph"><p>Consider first the 31 last parameters. They are straightforward to integrate
along time. Let us provide a constant angular velocity to the left shoulder.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#Do not forget to launch the viewer and establish connexion with initDisplay</span></span>
q <span style="color: #990000">=</span> robot<span style="color: #990000">.</span>q0
qdot <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span>nv<span style="color: #990000">)</span>
qdot<span style="color: #990000">[</span><span style="color: #993399">20</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">1</span>
dt <span style="color: #990000">=</span> <span style="color: #993399">5e-3</span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span><span style="color: #993399">1000</span><span style="color: #990000">):</span>
    q<span style="color: #990000">[</span><span style="color: #993399">7</span><span style="color: #990000">:]</span> <span style="color: #990000">+=</span> qdot<span style="color: #990000">[</span><span style="color: #993399">6</span><span style="color: #990000">:]*</span>dt
    robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">display</span></span><span style="color: #990000">(</span>q<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Looking in the display, the robot left arm rotates around the shoulder.</p></div>
<div class="paragraph"><p>This will not work for the rotation velocity. Try to increase directly the
quaternion would lead to inconsistancy:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>qdot<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">10</span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">):</span>
    q<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">]</span> <span style="color: #990000">+=</span> qdot<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">]*</span>dt
    robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">display</span></span><span style="color: #990000">(</span>q<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p><strong>What happened?</strong></p></div>
<div class="paragraph"><p>The quaternion norm is bigger than one, which then leads to a non orthonormal
matrix&#8230; the display explodes. We will integrate properly in the next Tutorial.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_2_integration_in_a_lie_group">Tutorial 2: Integration in a Lie Group</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>Objectives:</strong> Use the exponential of SE(3) to move one body in space.</p></div>
<div class="sect2">
<h3 id="_integration_in_se_3">Integration in SE(3)</h3>
<div class="paragraph"><p>To properly integrate, it is necessary to rely on the exponential map of SE(3),
that will produce a proper homogeneous matrix by integration of a constant
se(3) velocity. The exponential map for both SE(3) and SO(3) is available in
Pinocchio. First consider moving a single body with a constant velocity. What would
be the corresponding trajectory?</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> pinocchio as se3
N <span style="color: #990000">=</span> <span style="color: #993399">1000</span>
v <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">);</span> v<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">1.0</span> <span style="color: #990000">/</span> N
w <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">);</span> w<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">1.0</span> <span style="color: #990000">/</span> N
nu <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Motion</span></span><span style="color: #990000">(</span> v<span style="color: #990000">,</span> w <span style="color: #990000">)</span>

M <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Identity</span></span><span style="color: #990000">()</span>
robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">updateJointConfiguration</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">se3ToConfig</span></span><span style="color: #990000">(</span>M<span style="color: #990000">),</span><span style="color: #FF0000">'HeadRoll'</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span>N<span style="color: #990000">):</span>
   M <span style="color: #990000">=</span> M<span style="color: #990000">*</span>se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exp</span></span><span style="color: #990000">(</span>nu<span style="color: #990000">)</span>
   robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">updateJointConfiguration</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">se3ToConfig</span></span><span style="color: #990000">(</span>M<span style="color: #990000">),</span><span style="color: #FF0000">'HeadRoll'</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The exponential map integrates the se(3) velocity expressed in the body
frame. When the body rotates, the direction of the movement in the world frame
rotates as well (since it is constant in the body frame).</p></div>
<div class="paragraph"><p>It is also possible to consider the velocity as constant in the world frame w_nu. In
that case, the integration is done on the left, by M = se3.exp(w_nu). Try to
imagine the resulting trajectory before executing it. Why is it not what you
thought? Remember that w_nu is a se(3) element. What represents its linear component?</p></div>
<div class="paragraph"><p><strong>Question:</strong> During the integration, modify the body velocity so that the
 linear movement of the body in the world is constant.</p></div>
</div>
<div class="sect2">
<h3 id="_log_in_se_3">Log in SE(3)</h3>
<div class="paragraph"><p>Now, let us move the body to a given position Mdes. The velocity to be
integrate during a unit time interval is given by the log. It is possible to
interpolate the movement trivially, since the exponential of two colinear
elements comutes.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>N <span style="color: #990000">=</span> <span style="color: #993399">1000</span>
Mdes <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">()</span>
nu <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>M<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">inverse</span></span><span style="color: #990000">()*</span>Mdes<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span>N<span style="color: #990000">):</span>
    M <span style="color: #990000">=</span> M<span style="color: #990000">*</span>se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exp</span></span><span style="color: #990000">(</span>nu<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">vector</span></span><span style="color: #990000">()/</span>N<span style="color: #990000">)</span>
    robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">updateJointConfiguration</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">se3ToConfig</span></span><span style="color: #990000">(</span>M<span style="color: #990000">),</span><span style="color: #FF0000">'HeadRoll'</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Here, nu is the applied velocity expressed in the body frame; we therefore integrate on the right.
Double check that the obtained placement is exactly equals to the desired one.</p></div>
<div class="paragraph"><p>The same can be applied online in the loop to adapt the velocity to the current
position (no interrest except scholar in the case of a perfect integration; it
would be more interesting within a non-linear optimization scheme, see below).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">errorInSE3</span></span><span style="color: #990000">(</span> M<span style="color: #990000">,</span>Mdes<span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">  '''</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    Compute a 6-dim error vector (6x1 np.maptrix) caracterizing the difference</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    between M and Mdes, both element of SE3.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  '''</span></span>
  error <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>M<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">inverse</span></span><span style="color: #990000">()*</span>Mdes<span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> error<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">vector</span></span><span style="color: #990000">()</span>

N <span style="color: #990000">=</span> <span style="color: #993399">1000</span>
Mdes <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">()</span>
gain <span style="color: #990000">=</span> <span style="color: #993399">1.0</span> <span style="color: #990000">/</span> N
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span>N<span style="color: #990000">):</span>
    nu <span style="color: #990000">=</span> gain<span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #000000">errorInSE3</span></span><span style="color: #990000">(</span>M<span style="color: #990000">,</span>Mdes<span style="color: #990000">)</span>   <span style="font-style: italic"><span style="color: #9A1900"># nu is the desired spatial velocity.</span></span>
    M <span style="color: #990000">=</span> M<span style="color: #990000">*</span>se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exp</span></span><span style="color: #990000">(</span>nu<span style="color: #990000">)</span>
    robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">updateJointConfiguration</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">se3ToConfig</span></span><span style="color: #990000">(</span>M<span style="color: #990000">),</span><span style="color: #FF0000">'HeadRoll'</span><span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_integration_of_a_non_trivial_lie_group">Integration of a non-trivial Lie Group</h3>
<div class="paragraph"><p>The 7 first components of q are the hip position and orientation (stored as a
quaternion. The 6 first components of qdot are the se(3) velocity of the hip in
the body frame. The velocity integrates on the right.</p></div>
<div class="paragraph"><p>An additionnal step has to be added to obtain the SE(3) element from and back
to quaternion. This can be done using the se3.Quaternion class.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> pinocchio as se3
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">robotint</span></span><span style="color: #990000">(</span>q<span style="color: #990000">,</span>dq<span style="color: #990000">):</span>
    M <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SE3</span></span><span style="color: #990000">(</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Quaternion</span></span><span style="color: #990000">(</span>q<span style="color: #990000">[</span><span style="color: #993399">6</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">],</span>q<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">],</span>q<span style="color: #990000">[</span><span style="color: #993399">4</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">],</span>q<span style="color: #990000">[</span><span style="color: #993399">5</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">]).</span><span style="font-weight: bold"><span style="color: #000000">matrix</span></span><span style="color: #990000">(),</span> q<span style="color: #990000">[:</span><span style="color: #993399">3</span><span style="color: #990000">])</span>
    dM <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">exp</span></span><span style="color: #990000">(</span>dq<span style="color: #990000">[:</span><span style="color: #993399">6</span><span style="color: #990000">])</span>
    M <span style="color: #990000">=</span> M<span style="color: #990000">*</span>dM
    q<span style="color: #990000">[:</span><span style="color: #993399">3</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> M<span style="color: #990000">.</span>translation
    q<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">:</span><span style="color: #993399">7</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Quaternion</span></span><span style="color: #990000">(</span>M<span style="color: #990000">.</span>rotation<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">coeffs</span></span><span style="color: #990000">()</span>
    q<span style="color: #990000">[</span><span style="color: #993399">7</span><span style="color: #990000">:]</span> <span style="color: #990000">+=</span> dq<span style="color: #990000">[</span><span style="color: #993399">6</span><span style="color: #990000">:]</span></tt></pre></div></div>
<div class="paragraph"><p>qd is an increment (i.e. qdot*dt). The class se3.Quaternion is initialized from
the 4 components w,x,y,z of the quaternion (take care, this is not the same
order than the coeffs in q, as w is arbitrarily stored in head or tail). The
corresponding rotation matrix is obtained from quat.matrix(). It is composed
with the results of the exponential map. The obtained placement is finally
restored as a vector and stored in q. For the revolute joint parameters, the
integration is straightforward.</p></div>
<div class="paragraph"><p>The integration function is available in the RomeoWrapper class with
increment(q,dq).</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_3_solving_one_real_valued_geometric_task">Tutorial 3: solving one real-valued geometric task</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>Objective:</strong> Creating a motion from a real-valued geometric task and making the
             robot regulate the error to 0.</p></div>
<div class="paragraph"><p>Let us assume that we want to bring the center of the right wrist at abscissa 3
in the global frame.</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__1.png" alt="inverse-kinematics__1.png" />
</div>
</div>
<div class="paragraph"><p>We define the task error as the difference between the wrist abscissa in current
configuration and the goal abscissa.</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__2.png" alt="inverse-kinematics__2.png" />
</div>
</div>
<div class="paragraph"><p>We wish to impose</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__3.png" alt="inverse-kinematics__3.png" />
</div>
</div>
<div class="paragraph"><p>where k is a scalar parameter called gain, so that the error converges to 0.</p></div>
<div class="paragraph"><p>As the error depends on the configuration, the variation of the error depends on
the variation of the configuration through the gradient (considered as a row
vector):</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__4.png" alt="inverse-kinematics__4.png" />
</div>
</div>
<div class="paragraph"><p>Together with the proportional control of the error above, this latter equation
defines for any configuration an affine equation on the robot velocity.</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__5.png" alt="inverse-kinematics__5.png" />
</div>
</div>
<div class="paragraph"><p>The gradient is obtained from the tangent to the map which from q gives the
SE(3) placement of the hand. The tangent is available from the function
robot.Jrh(q). The tangent is expressed in the body frame. We are interrested by
the variation of the position (translation only) of the hand in the world. This
is obtained by rotating the three first rows of the tangent to expressed it in the world:
where [0:3,:] denotes the selection of the three first rows.</p></div>
<div class="paragraph"><p><strong>Question:</strong> Given the gradient of the error, the gain, and the value of the
          error, compute a derivative of the configuration solution to
          the above equation.</p></div>
<div class="paragraph"><p><a href="solution1.html"><strong>Solution</strong></a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_4_solving_one_vector_valued_geometric_task">Tutorial 4: solving one vector-valued geometric task</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>Objective:</strong> Creating a motion from a vector-valued geometric task and making
             the robot regulate the error to 0.</p></div>
<div class="sect2">
<h3 id="_with_an_objective_in_r_3">With an objective in R^3</h3>
<div class="paragraph"><p>Now, we want to bring the center of the left wrist at position (0,0,3)
in the global frame.</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__6.png" alt="inverse-kinematics__6.png" />
</div>
</div>
<div class="paragraph"><p>We define the task error as the vector-valued difference between the wrist
position in current configuration and the goal position.</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__7.png" alt="inverse-kinematics__7.png" />
</div>
</div>
<div class="paragraph"><p>We wish to impose</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__8.png" alt="inverse-kinematics__8.png" />
</div>
</div>
<div class="paragraph"><p>The variation of the error now depends on the variation of the configuration
through the Jacobian matrix:</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__9.png" alt="inverse-kinematics__9.png" />
</div>
</div>
<div class="paragraph"><p>Together with the proportional control of the error above, this latter equation
defines for any configuration an affine equation on the robot velocity.</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__10.png" alt="inverse-kinematics__10.png" />
</div>
</div>
<div class="paragraph"><p><strong>Question:</strong> Given the value of the error (given by
          <em>errorInSE3(robot.Mrh(q),Mdes)</em>), the Jacobian of the error (given by
          <em>robot.Jrh(q)</em>) and the gain, compute a derivative of the
          configuration solution to the above equation.</p></div>
<div class="paragraph"><p><a href="solution2.html"><strong>Solution</strong></a></p></div>
</div>
<div class="sect2">
<h3 id="_with_an_objective_in_se_3">With an objective in SE(3)</h3>
<div class="paragraph"><p>Now combine the solution obtain for a SE(3) configuration in tutorial 2 to
compute the desired se(3) velocity of the hand that will bring it toward a
desired placement (position and orientation). The procedure is summarized as
follow: compute the error between current and desired placement in SE(3);
obtained the se(3) velocity to reduce this error using the logarithm; transform
this se(3) velocity into a configuration velocity using the pseudo inverse of
tangent map Jrh; integrate.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_5_back_on_earth">Tutorial 5: Back on earth</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>Objective:</strong> Putting the robot in stable equilibrium by defining a composite
             task for the feet and the center of mass.</p></div>
<div class="paragraph"><p>The right and left ankle position and tangent are available using robot.Mrf,
robot.Mlf, robot.Jrf, robot.Jlf. The center of mass position and tangent map
are given by robot.com and robot.Jcom.</p></div>
<div class="paragraph"><p><strong>Question:</strong> repeating tutorial 3, compute a motion moving the left ankle,
          the right ankle and the center of mass to the reference values given
          below.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="assets/getting-started/images/./images/icons/tip.png" alt="Tip" />
</td>
<td class="content">To build a matrix by concatenating two matrix rows, you can use <a href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.append.html">numpy.append</a>.
You might wish to initialize a matrix with 0 row and a given number of columns.
you can use <code>matrix ([]).reshape (0, number_of_colums)</code></td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_6_solving_a_hierarchy_of_tasks">Tutorial 6: solving a hierarchy of tasks</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>Objective:</strong> implementing a hierarchy of tasks with two levels. The higher
             priority task is defined by the static balance task of Tutorial 5,
             and the lower priority task is defined by a reaching task of the
             right hand.</p></div>
<div class="paragraph"><p>We now respectively denote by</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__11.png" alt="inverse-kinematics__11.png" />
</div>
</div>
<div class="paragraph"><p>the higher and lower priority task errors and their Jacobian. For clarity, we do
not express anymore the dependency in the configuration of the robot. For each
task, we denote by</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__12.png" alt="inverse-kinematics__12.png" />
</div>
</div>
<div class="paragraph"><p>the desired error derivatives.</p></div>
<div class="paragraph"><p>The first task defines an affine equation on the configuration derivative:</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__13.png" alt="inverse-kinematics__13.png" />
</div>
</div>
<div class="paragraph"><p>As in Tutorial 3, The set of solution is an affine subspace defined by the
pseudo-inverse of the Jacobian:</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__14.png" alt="inverse-kinematics__14.png" />
</div>
</div>
<div class="paragraph"><p><strong><span class="black">u</span></strong> is a free parameter that will be chosen to satisfy task 2.</p></div>
<div class="paragraph"><p><strong>Question:</strong> compute a configuration derivative in the sub-space of solutions of
task 1 that satisfies task 2. Tasks are defined as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
Task 1: static balance, as in Tutorial 5,
</p>
</li>
<li>
<p>
Task 2: reaching task for right wrist as defined below.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_7_adding_a_posture_task">Tutorial 7: Adding a posture task</h2>
<div class="sectionbody">
<div class="paragraph"><p>We observe that the robot configuration is getting farther and farther from the
initial configuration. One reason is that the number of degrees of freedom
controlled by the two tasks of Tutorial 6 is still much smaller than the robot
total number of degrees of freedom. As we do not take into account joint limits,
this might lead to a joint moving beyond a limit. one simple way to overcome
this issue is to add a posture task at the lowest priority level.</p></div>
<div class="paragraph"><p>The corresponding error is defined by</p></div>
<div class="imageblock latex">
<div class="content">
<img src="assets/getting-started/images/inverse-kinematics__15.png" alt="inverse-kinematics__15.png" />
</div>
</div>
<div class="paragraph"><p>where the desired posture is stored in <code>robot.q0</code>.</p></div>
<div class="paragraph"><p><strong>Question:</strong> Add a posture task to the stack of tasks of Tutorial 6.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2015-03-06 16:13:32 CET
</div>
</div>
</body>
</html>
